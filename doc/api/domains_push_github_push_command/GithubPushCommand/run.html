<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1, user-scalable=no">
  <meta name="description" content="API docs for the run method from the GithubPushCommand class, for the Dart programming language.">
  <title>run method - GithubPushCommand class - github_push_command library - Dart API</title>


  
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,300;0,400;0,500;0,700;1,400&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet">
  
  <link rel="stylesheet" href="../../static-assets/github.css?v1">
  <link rel="stylesheet" href="../../static-assets/styles.css?v1">
  <link rel="icon" href="../../static-assets/favicon.png?v1">
  
</head>

<body data-base-href="../../" data-using-base-href="false" class="light-theme">
<div id="overlay-under-drawer"></div>
<header id="title">
  <span id="sidenav-left-toggle" class="material-symbols-outlined" role="button" tabindex="0">menu</span>
  <ol class="breadcrumbs gt-separated dark hidden-xs">
    <li><a href="../../index.html">learmond</a></li>
    <li><a href="../../domains_push_github_push_command/">domains&#47;push&#47;github_push_command.dart</a></li>
    <li><a href="../../domains_push_github_push_command/GithubPushCommand-class.html">GithubPushCommand</a></li>
    <li class="self-crumb">run method</li>
  </ol>
  <div class="self-name">run</div>
  <form class="search navbar-right" role="search">
    <input type="text" id="search-box" autocomplete="off" disabled class="form-control typeahead" placeholder="Loading search...">
  </form>
  <button class="toggle" id="theme-button" title="Toggle between light and dark mode" aria-label="Light and dark mode toggle">
    <span id="dark-theme-button" class="material-symbols-outlined" aria-hidden="true">
      dark_mode
    </span>
    <span id="light-theme-button" class="material-symbols-outlined" aria-hidden="true">
      light_mode
    </span>
  </button>
</header>
<main>
<div
    id="dartdoc-main-content"
    class="main-content"
    data-above-sidebar="domains_push_github_push_command&#47;GithubPushCommand-class-sidebar.html"
    data-below-sidebar="">
    <div>
<h1><span class="kind-method">run</span> method 
</h1></div>

    <section class="multi-line-signature">
      
  <div>
    <ol class="annotation-list">
        <li>@<a href="https://api.flutter.dev/flutter/dart-core/override-constant.html">override</a></li>
    </ol>
  </div>
<span class="returntype"><a href="https://api.flutter.dev/flutter/dart-core/Future-class.html">Future</a><span class="signature">&lt;<wbr><span class="type-parameter">void</span>&gt;</span></span>
<span class="name ">run</span>(<wbr>)

      <div class="features"><span class="feature">override</span></div>

    </section>
    
<section class="desc markdown">
  <p>Runs this command.</p>
<p>The return value is wrapped in a <code>Future</code> if necessary and returned by
<a href="https://pub.dev/documentation/args/2.7.0/command_runner/CommandRunner/runCommand.html">CommandRunner.runCommand</a>.</p>
</section>


    
<section class="summary source-code" id="source">
  <h2><span>Implementation</span></h2>
  <pre class="language-dart"><code class="language-dart">@override
Future&lt;void&gt; run() async {
  &#47;&#47; 1. Detect git repository
  final isGitRepo = await _isGitRepository();
  if (!isGitRepo) {
    stderr.writeln(
      &#39;Error: Not a git repository (or any of the parent directories).&#39;,
    );
    return;
  }

  &#47;&#47; 2. Detect changes
  final statusResult = await Process.run(&#39;git&#39;, [&#39;status&#39;, &#39;--porcelain&#39;]);
  if (statusResult.exitCode != 0) {
    stderr.add(
      statusResult.stderr as List&lt;int&gt;? ??
          utf8.encode(&#39;Failed to run git status.&#39;),
    );
    return;
  }
  final changedLines = (statusResult.stdout as String)
      .trim()
      .split(&#39;\n&#39;)
      .where((line) =&gt; line.isNotEmpty)
      .toList();
  if (changedLines.isEmpty) {
    stdout.writeln(&#39;No changes to commit.&#39;);
    return;
  }

  &#47;&#47; Parse changed files and their statuses
  final List&lt;String&gt; changedFiles = [];
  final List&lt;String&gt; changeDescriptions = [];
  final Map&lt;String, String&gt; modifiedFileDetails = {};

  for (var line in changedLines) {
    &#47;&#47; line format: XY filename (possibly with rename info)
    &#47;&#47; We consider the first character (index 0) or second character (index 1) to determine status
    String statusChar = line[0];
    if (statusChar == &#39; &#39;) {
      statusChar = line[1];
    }
    String type;
    switch (statusChar) {
      case &#39;M&#39;:
        type = &#39;modified&#39;;
        break;
      case &#39;A&#39;:
        type = &#39;added&#39;;
        break;
      case &#39;D&#39;:
        type = &#39;deleted&#39;;
        break;
      case &#39;R&#39;:
        type = &#39;renamed&#39;;
        break;
      case &#39;C&#39;:
        type = &#39;copied&#39;;
        break;
      case &#39;U&#39;:
        type = &#39;updated but unmerged&#39;;
        break;
      default:
        type = &#39;changed&#39;;
    }
    &#47;&#47; filename starts at index 3, but for rename, it&#39;s &quot;R100 oldfile -&gt; newfile&quot;
    String filenamePart = line.substring(3).trim();
    String filename;
    if (type == &#39;renamed&#39;) {
      &#47;&#47; extract new filename after &#39;-&gt;&#39;
      final parts = filenamePart.split(&#39;-&gt;&#39;);
      filename = parts.length &gt; 1 ? parts[1].trim() : filenamePart;
    } else {
      filename = filenamePart;
    }
    changedFiles.add(filename);
    changeDescriptions.add(&#39;$filename ($type)&#39;);
  }

  &#47;&#47; For modified files, get detailed modification info
  final modifiedFiles = &lt;String&gt;[];
  for (var desc in changeDescriptions) {
    if (desc.contains(&#39;(modified)&#39;)) {
      final filename = desc.substring(0, desc.indexOf(&#39; (modified)&#39;));
      modifiedFiles.add(filename);
    }
  }

  if (modifiedFiles.isNotEmpty) {
    &#47;&#47; Use git diff --name-status HEAD to get modification details
    final diffResult = await Process.run(&#39;git&#39;, [
      &#39;diff&#39;,
      &#39;--name-status&#39;,
      &#39;HEAD&#39;,
    ]);
    if (diffResult.exitCode == 0) {
      final diffLines = (diffResult.stdout as String).trim().split(&#39;\n&#39;);
      for (var modFile in modifiedFiles) {
        for (var diffLine in diffLines) {
          &#47;&#47; diffLine format: &lt;status&gt;\t&lt;file&gt;
          if (diffLine.endsWith(&#39;\t$modFile&#39;)) {
            final parts = diffLine.split(&#39;\t&#39;);
            if (parts.length &gt;= 2) {
              final diffStatus = parts[0];
              String detail = &#39;&#39;;
              switch (diffStatus) {
                case &#39;M&#39;:
                  detail = &#39;content modified&#39;;
                  break;
                case &#39;T&#39;:
                  detail = &#39;mode changed&#39;;
                  break;
                case &#39;U&#39;:
                  detail = &#39;unmerged&#39;;
                  break;
                default:
                  detail = &#39;modified&#39;;
              }
              modifiedFileDetails[modFile] = detail;
            }
            break;
          }
        }
      }
    }
  }

  &#47;&#47; 3. Stage all changes
  final addRes = await _runGit([&#39;add&#39;, &#39;.&#39;]);
  if (addRes != 0) exit(addRes);

  &#47;&#47; 4. Generate auto commit message
  final now = DateTime.now().toLocal();
  final timestamp = now.toIso8601String();

  final List&lt;String&gt; detailedDescriptions = [];
  for (var desc in changeDescriptions) {
    if (desc.contains(&#39;(modified)&#39;)) {
      final filename = desc.substring(0, desc.indexOf(&#39; (modified)&#39;));
      final detail = modifiedFileDetails[filename];
      if (detail != null) {
        detailedDescriptions.add(&#39;$filename (modified: $detail)&#39;);
        continue;
      }
    }
    detailedDescriptions.add(desc);
  }

  String autoMessage =
      &#39;Auto commit on $timestamp: ${changedFiles.length} file(s) changed: ${detailedDescriptions.join(&#39;, &#39;)}&#39;;

  &#47;&#47; 5. Prompt for optional message
  stdout.write(&#39;Enter optional commit message (press Enter to skip): &#39;);
  String? extraMessage = stdin.readLineSync(encoding: utf8)?.trim();
  if (extraMessage != null &amp;&amp; extraMessage.isNotEmpty) {
    autoMessage = &#39;$autoMessage - $extraMessage&#39;;
  }

  &#47;&#47; 6. Commit changes
  final commitRes = await _runGit([&#39;commit&#39;, &#39;-m&#39;, autoMessage]);
  if (commitRes != 0) exit(commitRes);

  &#47;&#47; 7. Push to origin and current branch
  final branch = await _getCurrentBranch();
  if (branch == null) {
    stderr.writeln(&#39;Error: Failed to determine current branch.&#39;);
    exit(1);
  }
  final pushRes = await _runGit([&#39;push&#39;, &#39;origin&#39;, branch]);
  if (pushRes != 0) exit(pushRes);

  &#47;&#47; Completed successfully
  return;
}</code></pre>
</section>


  </div> <!-- /.main-content -->
  <div id="dartdoc-sidebar-left" class="sidebar sidebar-offcanvas-left">
    <!-- The search input and breadcrumbs below are only responsively visible at low resolutions. -->
<header id="header-search-sidebar" class="hidden-l">
  <form class="search-sidebar" role="search">
    <input type="text" id="search-sidebar" autocomplete="off" disabled class="form-control typeahead" placeholder="Loading search...">
  </form>
</header>
<ol class="breadcrumbs gt-separated dark hidden-l" id="sidebar-nav">
    <li><a href="../../index.html">learmond</a></li>
    <li><a href="../../domains_push_github_push_command/">github_push_command</a></li>
    <li><a href="../../domains_push_github_push_command/GithubPushCommand-class.html">GithubPushCommand</a></li>
    <li class="self-crumb">run method</li>
</ol>

    <h5>GithubPushCommand class</h5>
    <div id="dartdoc-sidebar-left-content"></div>
  </div><!--/.sidebar-offcanvas-->
  <div id="dartdoc-sidebar-right" class="sidebar sidebar-offcanvas-right">
</div><!--/.sidebar-offcanvas-->
</main>
<footer>
  <span class="no-break">
    learmond
      0.0.1+4
  </span>
  
</footer>


<script src="../../static-assets/highlight.pack.js?v1"></script>
<script src="../../static-assets/docs.dart.js"></script>

</body>
</html>

